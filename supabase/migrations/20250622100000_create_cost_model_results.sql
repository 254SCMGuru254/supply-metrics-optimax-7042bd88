CREATE TABLE public.cost_model_results (
    id bigint generated by default as identity primary key,
    project_id uuid not null references public.projects(id) on delete cascade,
    user_id uuid not null references public.auth.users(id) on delete cascade,
    model_type text not null,
    inputs jsonb not null,
    results jsonb not null,
    recommendations text[],
    formula text,
    created_at timestamp with time zone default now(),
    constraint unique_cost_model_result unique (project_id, user_id, model_type)
);

ALTER TABLE public.cost_model_results ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Allow all access to own cost model results"
ON public.cost_model_results
AS PERMISSIVE FOR ALL
TO public
USING (auth.uid() = user_id);